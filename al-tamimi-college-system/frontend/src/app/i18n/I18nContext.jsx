import React, { createContext, useContext, useEffect, useMemo, useState } from "react";

const I18nContext = createContext(null);

const dict = {
  ru: {
    language: "Язык",
    ru: "Русский",
    ky: "Кыргызча",

    login_title: "Система колледжей Аль-Тамими",
    sign_in: "Войти",
    email: "Электронная почта",
    password: "Пароль",
    quick_role: "Быстрая смена ролей",
    admin: "Администратор",
    teacher: "Учитель",
    student: "Студент",
    parent: "Родитель",

    dashboard: "Дашборд",
    schedule: "Расписание",
    journal: "Журнал посещаемости",
    announcements: "Объявления",
    badges: "Бейджи",
    analytics: "Аналитика",

    student_goals: "Мои цели",
    student_goals_sub: "Индивидуальный план и цели по твоему прогрессу",
    teacher_tools: "Инструменты учителя",
    teacher_tools_sub: "Быстрые действия: награды и работа со студентами",
    admin_tools: "Инструменты администратора",
    admin_tools_sub: "Управление расписанием и быстрые админ-действия",

    ai_assistant: "ИИ помощник",
    insights: "Инсайты",
    chat: "Чат",
    ask_placeholder: "Напиши вопрос: риск, прогулы, топ группы...",
    send: "Отправить",

    ai_recommendations: "Рекомендации ИИ",
    my_goals: "Мои цели",
    add_goal_placeholder: "Добавь цель на неделю...",
    no_goals: "Пока нет целей",
    delete: "Удалить",

    award_badge: "Наградить бейджем",
    award: "Наградить",
    awarded_ok: "Бейдж выдан",
    teacher_quick_actions: "Подсказки учителю",
    tip_award_badge: "Награди лидера — это мотивация для группы.",
    tip_journal: "Журнал посещаемости",
    tip_journal_sub: "Отмечай присутствие и добавляй комментарии.",

    add_schedule_item: "Добавить занятие в расписание",
    group: "Группа",
    subject: "Предмет",
    day: "День",
    room: "Аудитория",
    start: "Начало",
    end: "Конец",
    create: "Создать",
    created_ok: "Создано",
    admin_quick_actions: "Подсказки админа",
    tip_news: "Объявления",
    tip_news_sub: "Публикуй новости для студентов и преподавателей.",
    tip_analytics: "Аналитика",
    tip_analytics_sub: "Смотри лидеров, прогульщиков и рейтинг групп.",

    no_data: "Нет данных",
    student_only: "Только для студентов",
    teacher_only: "Только для преподавателей/админов",
    admin_only: "Только для администраторов",

    signed_in_as: "В системе",
    log_out: "Выйти",
    role_based_view_for: "Роль:",

    attendance: "Посещаемость",
    performance_index: "Индекс успеваемости",
    risk: "Риск",
    avg_grade: "Средняя оценка",
    classes: "занятий",
    weekly_trend_demo: "Тренд за неделю (демо)",
    weekly_trend_sub: "Для хакатона: минимальная визуализация KPI.",
    latest_announcements: "Последние объявления",
    no_announcements_yet: "Пока нет объявлений.",

    schedule_title: "Расписание",
    schedule_sub: "Ваши занятия на неделю",
    no_schedule: "Нет занятий.",
    teacher_label: "Преподаватель",
    group_label: "Группа",
    room_label: "Аудитория",

    news_title: "Объявления",
    news_sub: "Админ публикует, остальные читают.",
    publish_new: "Опубликовать",
    publish: "Опубликовать",
    title_placeholder: "Заголовок",
    body_placeholder: "Текст",
    audience: "Аудитория",
    audience_all: "Все",
    audience_students: "Студенты",
    audience_teachers: "Преподаватели",
    no_announcements: "Нет объявлений.",
    system: "Система",

    badges_title: "Бейджи",
    badges_sub: "Мотивация: бейджи за посещаемость и успеваемость.",
    my_badges: "Мои бейджи",
    available_badges: "Доступные бейджи",
    awarded: "Выдан",
    no_badges_yet: "Пока нет бейджей.",
    no_badges_defined: "Бейджи не добавлены.",
    teachers_can_award: "Учителя/админы могут выдавать бейджи.",

    journal_title: "Журнал посещаемости",
    journal_only: "Раздел доступен для Учителя/Админа.",
    demo_view: "Демо (groupId=1, subjectId=1)",
    export_pdf: "Экспорт PDF",
    export_excel: "Экспорт Excel",
    date: "Дата",
    student_name: "Студент",
    status: "Статус",
    grade: "Оценка",
    comment: "Комментарий",
    no_records: "Нет записей.",
    journal_note: "Для хакатона этого достаточно: журнал + экспорт. Позже можно добавить фильтры.",

    admin_analytics_title: "Аналитика администратора",
    admin_analytics_sub: "Лидеры, риски, прогульщики и рейтинг групп",
    leaders: "Лидеры",
    top_students_by_pi: "Топ студентов по индексу успеваемости.",
    risk_list: "Список риска",
    no_students: "Нет студентов.",
    top_absentees: "Топ прогульщиков",
    absences: "Пропуски",
    top_groups: "Топ групп",
    attendance_rate: "Посещаемость",
    no_data_short: "Нет данных.",
    admin_only_section: "Раздел доступен для роли Админ.",

    mon: "Пн",
    tue: "Вт",
    wed: "Ср",
    thu: "Чт",
    fri: "Пт",
    sat: "Сб",
    sun: "Вс",

    footer_tagline: "Хакатон MVP · Единая цифровая система колледжа · Полная автоматизация процессов",

    login_subtitle: "Посещаемость · Риск · Аналитика · Награды",
    signing_in: "Входим...",
    demo_mode_note: "Демо режим работает даже без базы данных.",
    designed_for_judges: "Сделано для жюри",
    judges_subtitle: "Единый внутренний контур: документация, управление, учёт и автоматизация — в одном месте.",
    risk_indicator: "Индикатор риска",
    mvp_modules: "Модули MVP",
    identity_title: "Стиль AL TAMIMI",
    identity_subtitle: "Единая цифровая система колледжа: учёт, управление, документация и автоматизация процессов.",
    mission_title: "Цель хакатона",
    mission_text: "Разработать систему, которая переводит документацию, управление и учёт в единую внутреннюю цифровую систему, обеспечивая полную автоматизацию процессов.",
    green: "Зелёный",
    yellow: "Жёлтый",
    red: "Красный",

    download_weekly_report: "Скачать Weekly Report (PDF)",
    run_intervention: "Запустить план реагирования",
    intervention_plan: "План реагирования",
    notification_draft: "Черновик уведомления",
    copy: "Копировать",
    close: "Закрыть",
    demo_tour: "Demo Tour",
    tour_title: "Демо-сценарий",
    tour_step_student: "1) Студент: риск + цели",
    tour_step_teacher: "2) Учитель: журнал + бейджи",
    tour_step_admin: "3) Админ: аналитика + отчёт",
    tour_next: "Далее",
    tour_back: "Назад",
    tour_go: "Перейти",

    // Polls
    polls: "Опросы",
    create_poll: "Создать опрос",
    poll_question: "Вопрос опроса",
    poll_options: "Варианты ответа",
    add_option: "Добавить вариант",
    remove_option: "Удалить вариант",
    anonymous_voting: "Анонимное голосование",
    multiple_choice: "Множественный выбор",
    poll_ends: "Опрос заканчивается",
    vote: "Голосовать",
    view_results: "Посмотреть результаты",
    poll_analytics: "Аналитика опроса",
    total_votes: "Всего голосов",
    no_polls: "Нет опросов",
    poll_created: "Опрос создан",
    vote_cast: "Голос принят",

    // Gamification
    gamification: "Геймификация",
    level: "Уровень",
    xp: "Опыт",
    achievements: "Достижения",
    leaderboard: "Таблица лидеров",
    achievement_unlocked: "Достижение разблокировано",
    xp_earned: "Опыт получен",
    level_up: "Новый уровень!",
    no_achievements: "Нет достижений",
    rank: "Ранг",

    // Parent Portal
    parent_portal: "Родительский портал",
    link_student: "Привязать студента",
    student_email: "Email студента",
    relationship: "Отношение",
    mother: "Мать",
    father: "Отец",
    guardian: "Опекун",
    linked_students: "Привязанные студенты",
    student_progress: "Прогресс студента",
    attendance_rate_parent: "Посещаемость",
    performance_parent: "Успеваемость",
    recent_grades_parent: "Последние оценки",
    announcements_parent: "Объявления",
    no_linked_students: "Нет привязанных студентов",
    student_linked: "Студент привязан",

    // Delete
    delete_action: "Удалить",
    delete_news: "Удалить новость",
    confirm_delete: "Подтвердить удаление",
    news_deleted: "Новость удалена",

    // Unified Dashboard
    quick_actions: "Быстрые действия",
    teacher_actions: "Действия учителя",
    view_schedule: "Просмотреть расписание",
    my_progress: "Мой прогресс",
    attendance_journal: "Журнал посещаемости",
    group_analytics: "Аналитика группы",
    total_students: "Всего студентов",
    students_unified: "Студенты",
    avg_attendance: "Средняя посещаемость",
    attendance_records: "Записи посещаемости",
    admin_view: "Админ панель",
    admin_tools_unified: "Админ инструменты",
    performance_index_unified: "Индекс успеваемости",
    risk_level_unified: "Уровень риска",

    // Social Network
    social_network: "Социалдык тармак",
    what_s_new: "Жаңылык барбы?",
    publish_social: "Жарыялоо",
    clubs: "Клубдар",
    trending: "Тренддер",
    events: "Окуялар",
    join: "Катышуу",
    participants: "катышуучулар",
    posts: "посттор",
    chat_social: "Чат",
    analytics_social: "Аналитика",
    export_social: "Экспорт",
    search_analytics: "Аналитикада издөө",
    today: "Бүгүн",
    this_week: "Бул аптада",
    this_month: "Бул айда",
    this_year: "Бул жылы",
    total_users: "Бардык колдонуучулар",
    active_sessions: "Активдүү сессиялар",
    total_posts: "Бардык посттор",
    achievements_social: "Жетишкендиктер",
    user_activity: "Колдонуучулар активдүүлүгү",
    performance_metrics: "Өндүрүш метрикалары",
    detailed_statistics: "Деталдуу статистика",
    date_social: "Күн",
    users_social: "Колдонуучулар",
    sessions_social: "Сессиялар",
    engagement: "Катышуу",
    no_analytics_data: "Аналитика маалыматы жок",
    chart_placeholder: "График бул жерде болот",
    search_chats: "Чаттарды издөө",
    no_messages: "Билдирүү жок",
    select_chat: "Чатты тандаңыз",
    type_message: "Билдирүү жазыңыз...",
    online: "Тармакта",

    // Teacher Tools
    search_students: "Студенттерди издөө",
    award_badge_teacher: "Белги ыйгаруу",
    create_badge: "Белги түзүү",
    available_badges_teacher: "Жеткиликтүү белгилер",
    choose_student: "Студентти тандаңыз",
    choose_badge: "Белгини тандаңыз",
    cancel: "Жокко чыгаруу",
    add_grade: "Баа кошуу",
    add: "Кошуу",
    subject_teacher: "Предмет",
    grade_teacher: "Баа",
    comment_teacher: "Комментарий",
    my_schedule: "Менин жадыбалым",
    add_lesson: "Сабак кошуу",
    recent_grades_teacher: "Акыркы баалар",
    actions: "Аракеттер",
    class_analytics: "Класс аналитикасы",
    avg_performance: "Орточо окуу",
    risk_students: "Тобокелдүү студенттер",
    performance_distribution: "Окуу бөлүштүрүлүшү",
  },
  ky: {
    language: "Тил",
    ru: "Русча",
    ky: "Кыргызча",
    // ... (rest of the code remains the same)

    login_title: "Аль-Тамими колледж системасы",
    sign_in: "Кирүү",
    email: "Электрондук почта",
    password: "Сырсөз",
    quick_role: "Ролду тез алмаштыруу",
    admin: "Админ",
    teacher: "Мугалим",
    student: "Студент",
    parent: "Ата-эне",

    dashboard: "Башкы панель",
    schedule: "Жадыбал",
    journal: "Катышуу журналы",
    announcements: "Билдирүүлөр",
    badges: "Белгилер",
    analytics: "Аналитика",

    student_goals: "Максаттарым",
    student_goals_sub: "Прогресске жараша жеке план жана максаттар",
    teacher_tools: "Мугалим куралдары",
    teacher_tools_sub: "Тез аракеттер: сыйлыктар жана студенттер менен иш",
    admin_tools: "Админ куралдары",
    admin_tools_sub: "Жадыбалды башкаруу жана тез админ аракеттери",

    ai_assistant: "ИИ жардамчы",
    insights: "Инсайттар",
    chat: "Чат",
    ask_placeholder: "Суроо бер: тобокел, прогульщиктер, топ топтор...",
    send: "Жөнөтүү",

    ai_recommendations: "ИИ сунуштар",
    my_goals: "Максаттарым",
    add_goal_placeholder: "Аптага максат кош...",
    no_goals: "Азырынча максат жок",
    delete: "Өчүрүү",

    award_badge: "Белги ыйгаруу",
    award: "Ыйгаруу",
    awarded_ok: "Белги ыйгарылды",
    teacher_quick_actions: "Мугалим үчүн кеңеш",
    tip_award_badge: "Лидерге белги бер — бул мотивация.",
    tip_journal: "Катышуу журналы",
    tip_journal_sub: "Катышууну белгилеп, комментарий калтыр.",

    add_schedule_item: "Жадыбалга сабак кошуу",
    group: "Топ",
    subject: "Предмет",
    day: "Күн",
    room: "Бөлмө",
    start: "Башталышы",
    end: "Аякташы",
    create: "Түзүү",
    created_ok: "Түзүлдү",
    admin_quick_actions: "Админ кеңештери",
    tip_news: "Билдирүүлөр",
    tip_news_sub: "Студенттер жана мугалимдер үчүн жаңылык жарыяла.",
    tip_analytics: "Аналитика",
    tip_analytics_sub: "Лидерлерди, прогульщиктерди жана топ рейтингин көр.",

    no_data: "Маалымат жок",
    student_only: "Студенттер үчүн гана",
    teacher_only: "Мугалим/админ үчүн гана",
    admin_only: "Админ үчүн гана",

    signed_in_as: "Кирген",
    log_out: "Чыгуу",
    role_based_view_for: "Роль:",

    attendance: "Катышуу",
    performance_index: "Окуу индекси",
    risk: "Тобокел",
    avg_grade: "Орточо баа",
    classes: "сабак",
    weekly_trend_demo: "Апталык тренд (демо)",
    weekly_trend_sub: "Хакатон үчүн: KPIнин жөнөкөй графиги.",
    latest_announcements: "Акыркы билдирүүлөр",
    no_announcements_yet: "Азырынча билдирүү жок.",

    schedule_title: "Жадыбал",
    schedule_sub: "Сиздин апталык сабактар",
    no_schedule: "Сабак жок.",
    teacher_label: "Мугалим",
    group_label: "Топ",
    room_label: "Бөлмө",

    news_title: "Билдирүүлөр",
    news_sub: "Админ жарыялайт, калгандары окуйт.",
    publish_new: "Жарыялоо",
    publish: "Жарыялоо",
    title_placeholder: "Аталышы",
    body_placeholder: "Текст",
    audience: "Аудитория",
    audience_all: "Баары",
    audience_students: "Студенттер",
    audience_teachers: "Мугалимдер",
    no_announcements: "Билдирүү жок.",
    system: "Система",

    badges_title: "Белгилер",
    badges_sub: "Мотивация: катышуу жана окуу үчүн белгилер.",
    my_badges: "Белгілерим",
    available_badges: "Жеткиликтүү белгилер",
    awarded: "Ыйгарылган",
    no_badges_yet: "Азырынча белги жок.",
    no_badges_defined: "Белгилер кошулган эмес.",
    teachers_can_award: "Мугалим/админ белги ыйгара алат.",

    journal_title: "Катышуу журналы",
    journal_only: "Бөлүм мугалим/админ үчүн гана.",
    demo_view: "Демо (groupId=1, subjectId=1)",
    export_pdf: "PDF экспорт",
    export_excel: "Excel экспорт",
    date: "Күн",
    student_name: "Студент",
    status: "Статус",
    grade: "Баа",
    comment: "Комментарий",
    no_records: "Жазуу жок.",
    journal_note: "Хакатон үчүн жетиштүү: журнал + экспорт. Кийин фильтр кошсо болот.",

    admin_analytics_title: "Админ аналитикасы",
    admin_analytics_sub: "Лидерлер, тобокел, прогульщиктер жана топ рейтинги",
    leaders: "Лидерлер",
    top_students_by_pi: "Окуу индекси боюнча топ студенттер.",
    risk_list: "Тобокел тизмеси",
    no_students: "Студент жок.",
    top_absentees: "Прогульщиктер топ",
    absences: "Калтырган",
    top_groups: "Топ рейтинг",
    attendance_rate: "Катышуу",
    no_data_short: "Маалымат жок.",
    admin_only_section: "Бөлүм админ үчүн гана.",

    mon: "Дш",
    tue: "Шш",
    wed: "Шр",
    thu: "Бш",
    fri: "Жм",
    sat: "Иш",
    sun: "Жш",

    footer_tagline: "Хакатон MVP · Колледждин ички санарип системасы · Процесстерди автоматташтыруу",

    login_subtitle: "Катышуу · Тобокел · Аналитика · Сыйлыктар",
    signing_in: "Кирүү...",
    demo_mode_note: "Демо режим база жок болсо да иштейт.",
    designed_for_judges: "Калыстар үчүн",
    judges_subtitle: "Бирдиктүү санарип контур: документ, башкаруу, эсеп жана автоматташтыруу — бир жерде.",
    risk_indicator: "Тобокел индикатору",
    mvp_modules: "MVP модулдар",
    identity_title: "AL TAMIMI стили",
    identity_subtitle: "Колледждин бирдиктүү санарип системасы: эсеп, башкаруу, документ жана процесстерди автоматташтыруу.",
    mission_title: "Хакатондун максаты",
    mission_text: "Документтештирүү, башкаруу жана эсеп жүргүзүүнү бирдиктүү ички санарип системага өткөрүп, процесстерди толук автоматташтырган система түзүү.",
    green: "Жашыл",
    yellow: "Сары",
    red: "Кызыл",

    download_weekly_report: "Weekly Report (PDF) жүктөө",
    run_intervention: "Реакция планын иштетүү",
    intervention_plan: "Реакция планы",
    notification_draft: "Билдирүү черновиги",
    copy: "Көчүрүү",
    close: "Жабуу",
    demo_tour: "Demo Tour",
    tour_title: "Демо-сценарий",
    tour_step_student: "1) Студент: тобокел + максат",
    tour_step_teacher: "2) Мугалим: журнал + белгилер",
    tour_step_admin: "3) Админ: аналитика + отчёт",
    tour_next: "Кийинки",
  },
};

export function I18nProvider({ children }) {
  const [lang, setLang] = useState(() => {
    try {
      return localStorage.getItem("altamimi_lang") || "ru";
    } catch {
      return "ru";
    }
  });

  useEffect(() => {
    try {
      localStorage.setItem("altamimi_lang", lang);
    } catch {
      // Ignore localStorage errors
    }
  }, [lang]);

  const t = useMemo(() => {
    return (key) => {
      try {
        return dict[lang]?.[key] ?? dict.ru[key] ?? key;
      } catch {
        return key;
      }
    };
  }, [lang]);

  const value = useMemo(() => ({ lang, setLang, t }), [lang, t]);
  return <I18nContext.Provider value={value}>{children}</I18nContext.Provider>;
}

export function useI18n() {
  const ctx = useContext(I18nContext);
  if (!ctx) {
    // Безопасная заглушка вместо ошибки
    return {
      lang: "ru",
      setLang: () => {},
      t: (key) => key
    };
  }
  return ctx;
}
