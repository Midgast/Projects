{% extends 'core/base.html' %}
{% load static %}

{% block title %}–ö–∞–±–∏–Ω–µ—Ç –°—Ç—É–¥–µ–Ω—Ç–∞{% endblock %}

{% block content %}
  <header class="topbar">
    <div class="hello">
      <h1 class="hello__title">–ü—Ä–∏–≤–µ—Ç, {{ profile.user.first_name|default:profile.user.username }} <span aria-hidden="true">üëã</span></h1>
      <p class="hello__sub">{{ profile.course }} –∫—É—Ä—Å, {{ profile.specialty }}</p>
    </div>

    <div class="me" aria-label="–ü—Ä–æ—Ñ–∏–ª—å">
      {% if profile.avatar %}
        <img class="me__avatar" src="{{ profile.avatar.url }}" alt="–ê–≤–∞—Ç–∞—Ä">
      {% else %}
        <div class="me__avatar me__avatar--fallback" aria-hidden="true">üë®‚Äçüéì</div>
      {% endif %}
    </div>
  </header>

  <section class="bento" aria-label="–í–∏–¥–∂–µ—Ç—ã">
      <!-- Widget 1: Big -->
      <article class="card tilt" data-tilt>
        <div class="card__head">
          <h2 class="card__title">–ú–æ–π —Ä–µ–π—Ç–∏–Ω–≥</h2>
          <span class="pill">–ê–∫—Ç—É–∞–ª—å–Ω–æ</span>
        </div>

        <div class="rating">
          <div class="ring" role="img" aria-label="–†–µ–π—Ç–∏–Ω–≥ –∏ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å">
            <svg viewBox="0 0 36 36" class="ring__svg" aria-hidden="true">
              <path class="ring__bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
              <path class="ring__fg"
                    style="stroke-dasharray: {{ stats.attendance }}, 100"
                    d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
            </svg>
            <div class="ring__text">
              <span class="ring__value">{{ stats.gpa }}</span>
              <span class="ring__label">GPA</span>
            </div>
          </div>

          <div class="rating__meta">
            <div class="stat">
              <span class="stat__k">–ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å</span>
              <span class="stat__v">{{ stats.attendance }}%</span>
            </div>
            <div class="stat">
              <span class="stat__k">–°—Ç–∞—Ç—É—Å</span>
              <span class="stat__v">–°—Ç–∞–±–∏–ª—å–Ω–æ</span>
            </div>
          </div>
        </div>

        <div class="glare" aria-hidden="true"></div>
      </article>

      <!-- Widget 2: Medium -->
      <article class="card tilt" data-tilt>
        <div class="card__head">
          <h2 class="card__title">–°–ª–µ–¥—É—é—â–∞—è –ø–∞—Ä–∞</h2>
          <span class="pill pill--accent">–¢–∞–π–º–µ—Ä</span>
        </div>

        {% if next_lesson %}
          <div class="lesson">
            <div class="lesson__main">
              <p class="lesson__subject">{{ next_lesson.subject }}</p>
              <p class="lesson__meta">{{ next_lesson.location }} ‚Ä¢ {{ next_lesson.teacher }}</p>
            </div>

            <div class="countdown" data-countdown data-target="{{ next_lesson_ts|default:'' }}">
              <span class="countdown__label">–ù–∞—á–Ω—ë—Ç—Å—è —á–µ—Ä–µ–∑</span>
              <span class="countdown__time">‚Äî</span>
            </div>
          </div>
        {% else %}
          <p class="muted">–°–µ–≥–æ–¥–Ω—è –ø–∞—Ä –Ω–µ—Ç.</p>
        {% endif %}

        <div class="glare" aria-hidden="true"></div>
      </article>

      <!-- Widget 3: Tall -->
      <article class="card tilt card--tall" data-tilt>
        <div class="card__head">
          <h2 class="card__title">–î–æ–º–∞—à–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è</h2>
          <span class="pill pill--soft">–°–ø–∏—Å–æ–∫</span>
        </div>

        <ul class="tasks" role="list">
          {% for task in homeworks %}
            <li class="task {% if task.completed %}is-done{% endif %}" data-task data-id="{{ task.id }}">
              <button class="task__btn" type="button" aria-label="–û—Ç–º–µ—Ç–∏—Ç—å –∑–∞–¥–∞—á—É –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π">
                <span class="task__check" aria-hidden="true"><i class="ri-check-line"></i></span>
              </button>
              <div class="task__info">
                <span class="task__title">{{ task.title }}</span>
                <span class="task__deadline">{{ task.deadline }}</span>
              </div>
            </li>
          {% empty %}
            <li class="muted">–ó–∞–¥–∞—á –Ω–µ—Ç.</li>
          {% endfor %}
        </ul>

        <div class="glare" aria-hidden="true"></div>
      </article>

      <!-- Widget 4: Wide (–ù–æ–≤–æ—Å—Ç–∏) -->
      <article class="card tilt card--wide" data-tilt>
        <div class="card__head">
          <h2 class="card__title">–ù–æ–≤–æ—Å—Ç–∏</h2>
          <span class="pill">–°–µ–≥–æ–¥–Ω—è</span>
        </div>

        <div class="news">
          {% for item in news_items %}
            <a class="news__item" href="#" aria-label="–û—Ç–∫—Ä—ã—Ç—å –Ω–æ–≤–æ—Å—Ç—å">
              <div class="news__img" style="background-image:url('{{ item.image_url }}');"></div>
              <div class="news__txt">
                <span class="news__tag">{{ item.tag }}</span>
                <span class="news__title">{{ item.title }}</span>
              </div>
            </a>
          {% endfor %}
        </div>

        <div class="glare" aria-hidden="true"></div>
      </article>

        <!-- Widget 5: –†–µ–π—Ç–∏–Ω–≥ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ -->
        <article class="card tilt" data-tilt>
          <div class="card__head">
            <h2 class="card__title">–†–µ–π—Ç–∏–Ω–≥ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</h2>
            <span class="pill">–¢–æ–ø-5 GPA</span>
          </div>
          {% if top_students %}
          <table class="rating-table" style="width:100%;margin-top:10px;">
            <thead>
              <tr>
                <th>–°—Ç—É–¥–µ–Ω—Ç</th>
                <th>–ö—É—Ä—Å</th>
                <th>GPA</th>
              </tr>
            </thead>
            <tbody>
              {% for s in top_students %}
              <tr>
                <td>{{ s.user.first_name|default:s.user.username }}</td>
                <td>{{ s.course }}</td>
                <td>{{ s.gpa }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
          {% else %}
          <p class="muted">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ —Ä–µ–π—Ç–∏–Ω–≥—É.</p>
          {% endif %}
          <div class="glare" aria-hidden="true"></div>
        </article>
    </section>
  </section>
{% endblock %}
