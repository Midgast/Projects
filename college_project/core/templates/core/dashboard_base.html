{% load static %}
<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>{% block title %}College Core{% endblock %}</title>

  <link rel="stylesheet" href="{% static 'css/style.css' %}">
  <script defer src="{% static 'js/tilt.js' %}"></script>
  <script defer src="{% static 'js/app.js' %}"></script>
  <script defer src="{% static 'js/notifications.js' %}"></script>
</head>

<body class="app-shell">
  <aside class="sidebar" aria-label="Навигация">
    <div class="side-top">
      <a class="brand" href="/dashboard/">
        <span class="brand-dot"></span>
        <span class="brand-text">College Core</span>
      </a>
    </div>

    {% with is_student=request.user.student|default_if_none:None %}
    {% with is_teacher=request.user.teacher|default_if_none:None %}
    {% with is_director=request.user.director|default_if_none:None %}

    <nav class="side-nav">
      <!-- always -->
      <a class="nav-item {% if request.path|slice:':10' == '/dashboard' %}active{% endif %}" href="/dashboard/">
        <span class="ico">⌂</span><span class="txt">Дашборд</span>
      </a>

      <!-- Student -->
      {% if is_student %}
        <a class="nav-item {% if request.path == '/schedule/' %}active{% endif %}" href="/schedule/">
          <span class="ico">▦</span><span class="txt">Расписание</span>
        </a>
        <a class="nav-item {% if request.path == '/grades/' %}active{% endif %}" href="/grades/">
          <span class="ico">◎</span><span class="txt">Оценки</span>
        </a>
        <a class="nav-item {% if request.path == '/homeworks/' %}active{% endif %}" href="/homeworks/">
          <span class="ico">☑</span><span class="txt">Домашки</span>
        </a>
        <a class="nav-item {% if request.path == '/remarks/' %}active{% endif %}" href="/remarks/">
          <span class="ico">!</span><span class="txt">Замечания</span>
        </a>
        <a class="nav-item {% if request.path == '/rating/' %}active{% endif %}" href="/rating/">
          <span class="ico">⇧</span><span class="txt">Рейтинг</span>
        </a>
      {% endif %}

      <!-- Teacher -->
      {% if is_teacher and not is_student and not is_director %}
        <a class="nav-item {% if request.path == '/schedule/' %}active{% endif %}" href="/schedule/">
          <span class="ico">▦</span><span class="txt">Расписание</span>
        </a>
        <a class="nav-item {% if request.path == '/grades/' %}active{% endif %}" href="/grades/">
          <span class="ico">◎</span><span class="txt">Журнал оценок</span>
        </a>
        <a class="nav-item {% if request.path == '/homeworks/' %}active{% endif %}" href="/homeworks/">
          <span class="ico">☑</span><span class="txt">Домашки</span>
        </a>
        <a class="nav-item {% if request.path == '/remarks/' %}active{% endif %}" href="/remarks/">
          <span class="ico">!</span><span class="txt">Замечания</span>
        </a>
      {% endif %}

      <!-- Director -->
      {% if is_director %}
        <a class="nav-item {% if request.path == '/rating/' %}active{% endif %}" href="/rating/">
          <span class="ico">⇧</span><span class="txt">Рейтинг</span>
        </a>
        <a class="nav-item {% if request.path == '/remarks/' %}active{% endif %}" href="/remarks/">
          <span class="ico">!</span><span class="txt">Замечания</span>
        </a>

        {# если директор ещё и teacher — показываем преподавательские рабочие разделы #}
        {% if is_teacher %}
          <div class="nav-sep"></div>
          <div class="nav-caption">Преподаватель</div>
          <a class="nav-item {% if request.path == '/schedule/' %}active{% endif %}" href="/schedule/">
            <span class="ico">▦</span><span class="txt">Расписание</span>
          </a>
          <a class="nav-item {% if request.path == '/grades/' %}active{% endif %}" href="/grades/">
            <span class="ico">◎</span><span class="txt">Журнал оценок</span>
          </a>
          <a class="nav-item {% if request.path == '/homeworks/' %}active{% endif %}" href="/homeworks/">
            <span class="ico">☑</span><span class="txt">Домашки</span>
          </a>
        {% endif %}
      {% endif %}

      <!-- Shared -->
      <div class="nav-sep"></div>
      <a class="nav-item {% if request.path == '/news/' %}active{% endif %}" href="/news/">
        <span class="ico">◻</span><span class="txt">Новости</span>
      </a>
      <a class="nav-item {% if request.path == '/notifications/' %}active{% endif %}" href="/notifications/">
        <span class="ico">◉</span><span class="txt">Уведомления</span>
        {% if unread_notifications_count %}
          <span class="badge">{{ unread_notifications_count }}</span>
        {% endif %}
      </a>
      <a class="nav-item {% if request.path == '/settings/' %}active{% endif %}" href="/settings/">
        <span class="ico">⚙</span><span class="txt">Настройки</span>
      </a>
    </nav>

    {% endwith %}{% endwith %}{% endwith %}

    <div class="side-bottom">
      <a class="nav-item" href="/admin/" {% if not request.user.is_staff %}style="display:none"{% endif %}>
        <span class="ico">⛭</span><span class="txt">Админка</span>
      </a>
      <a class="nav-item danger" href="/logout/">
        <span class="ico">⎋</span><span class="txt">Выйти</span>
      </a>
    </div>
  </aside>

  <main class="main">
    <header class="topbar">
      <div class="top-left">{% block topbar_left %}{% endblock %}</div>

      <div class="top-right">
        <a class="profile-chip" href="/settings/" aria-label="Профиль">
          <span class="avatar">
            {{ request.user.username|slice:":1"|upper }}
          </span>
          <span class="who">
            <span class="name">{{ request.user.first_name|default:request.user.username }}</span>
            <span class="role">
              {% if request.user.director %}Директор{% elif request.user.teacher %}Преподаватель{% elif request.user.student %}Студент{% else %}Пользователь{% endif %}
            </span>
          </span>
        </a>
      </div>
    </header>

    <section class="content">
      {% block content %}{% endblock %}
    </section>
  </main>
</body>
</html>
