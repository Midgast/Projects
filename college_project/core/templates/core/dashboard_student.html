{% extends "core/dashboard_base.html" %}
{% block title %}Student Dashboard ‚Ä¢ College Core{% endblock %}

{% block topbar_left %}
  <div class="crumbs">–°—Ç—É–¥–µ–Ω—Ç ‚Ä¢ {{ student.group.code }}</div>
{% endblock %}

{% block content %}

<section class="page-head">
  <div>
    <h1 class="page-title">–ü—Ä–∏–≤–µ—Ç, {{ request.user.first_name|default:request.user.username }} üëã</h1>
    <p class="page-subtitle">–¢–≤–æ–π –¥–µ–Ω—å –≤ –æ–¥–Ω–æ–º —ç–∫—Ä–∞–Ω–µ. –°—Ç–µ–∫–ª–æ, —Å–∫–æ—Ä–æ—Å—Ç—å, —Ñ–æ–∫—É—Å.</p>
  </div>
  <div class="pill">–ú–µ—Å—Ç–æ –≤ –≥—Ä—É–ø–ø–µ: <b>{{ group_place|default:"‚Äî" }}</b> / {{ group_total|default:"‚Äî" }}</div>
</section>

<section class="bento">
  <!-- Widget 1 (Big): My Rating -->
  <article class="card big tilt" data-tilt>
    <div class="card-head">
      <h2 class="card-title">–ú–æ–π —Ä–µ–π—Ç–∏–Ω–≥</h2>
      <span class="pill">GPA {{ student.gpa }} ‚Ä¢ {{ stats.attendance }}</span>
    </div>

    <div class="rating-wrap">
      <div class="ring" style="--p: {{ student.attendance }};">
        <div class="ring-center">
          <div class="ring-big">{{ student.gpa }}</div>
          <div class="ring-sub">–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</div>
        </div>
      </div>

      <div class="kv" style="margin-top: 12px;">
        <div class="kv-row">
          <span class="kv-k">–ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å</span>
          <span class="kv-v">{{ stats.attendance }}</span>
        </div>
        <div class="kv-row">
          <span class="kv-k">–°—Ä–µ–¥–Ω—è—è –æ—Ü–µ–Ω–∫–∞</span>
          <span class="kv-v">{{ stats.avg_grade|floatformat:1 }}</span>
        </div>
      </div>
    </div>
  </article>

  <!-- Widget 2 (Medium): Next lesson -->
  <article class="card tilt" data-tilt style="grid-column: span 6;">
    <div class="card-head">
      <h2 class="card-title">–°–ª–µ–¥—É—é—â–∞—è –ø–∞—Ä–∞</h2>
      {% if next_lesson %}
        <span class="pill">{{ next_lesson.location }}</span>
      {% else %}
        <span class="pill">–ù–µ—Ç</span>
      {% endif %}
    </div>

    {% if next_lesson %}
      <div class="next">
        <div class="next-main">
          <div class="next-title">{{ next_lesson.subject.name }}</div>
          <div class="next-sub">
            –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å: {{ next_lesson.teacher.user.get_full_name|default:next_lesson.teacher.user.username }}
          </div>
        </div>

        <div class="list-item" style="margin-top: 12px;">
          <div class="list-left">
            <div class="dot"></div>
            <div>
              <div class="list-title">{{ next_lesson_start|date:"D, d M" }}</div>
              <div class="list-sub">{{ next_lesson.time_start }} ‚Äî {{ next_lesson.time_end }}</div>
            </div>
          </div>
          <div class="tag good">–°–∫–æ—Ä–æ</div>
        </div>

        <div class="list-item" style="margin-top: 10px;" data-countdown data-target-ms="{{ timestamp_ms }}">
          <div class="list-left">
            <div class="dot"></div>
            <div>
              <div class="list-title">–î–æ –Ω–∞—á–∞–ª–∞</div>
              <div class="list-sub muted">–û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É</div>
            </div>
          </div>
          <div class="list-meta" data-countdown-text>00:00:00</div>
        </div>
      </div>
    {% else %}
      <p class="muted">–ù–∞ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è –ø–∞—Ä –Ω–µ—Ç.</p>
    {% endif %}
  </article>

  <!-- Widget 3 (Tall): Homeworks -->
  <article class="card tall tilt" data-tilt>
    <div class="card-head">
      <h2 class="card-title">–î–æ–º–∞—à–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è</h2>
      <span class="pill">–¢–∞–ø–Ω–∏ ‚Äî –æ—Ç–º–µ—Ç–∏—Ç—å</span>
    </div>

    <div class="list">
      {% for hw in homeworks %}
        <div class="list-item" data-hw-row data-id="{{ hw.id }}" data-completed="{% if hw.completed %}1{% else %}0{% endif %}">
          <div class="list-left" style="min-width:0;">
            <div class="check {% if hw.completed %}on{% endif %}">
              {% if hw.completed %}‚úì{% else %}&nbsp;{% endif %}
            </div>
            <div style="min-width:0;">
              <div class="list-title">{{ hw.title }}</div>
              <div class="list-sub">{{ hw.subject.name }} ‚Ä¢ –¥–µ–¥–ª–∞–π–Ω {{ hw.deadline|date:"d M" }}</div>
            </div>
          </div>

          <button class="btn ghost" data-hw-toggle data-id="{{ hw.id }}" style="padding: 8px 10px; border-radius: 14px;">
            {% if hw.completed %}–°–Ω—è—Ç—å{% else %}–ì–æ—Ç–æ–≤–æ{% endif %}
          </button>
        </div>
      {% empty %}
        <p class="muted">–î–æ–º–∞—à–µ–∫ –Ω–µ—Ç. –ö—Ä–∞—Å–æ—Ç–∞.</p>
      {% endfor %}
    </div>
  </article>

  <!-- Widget 4 (Wide): News -->
  <article class="card wide tilt" data-tilt>
    <div class="card-head">
      <h2 class="card-title">–ù–æ–≤–æ—Å—Ç–∏</h2>
      <a class="btn ghost" href="/news/">–í—Å–µ –Ω–æ–≤–æ—Å—Ç–∏</a>
    </div>

    <div class="news-grid">
      {% for n in news %}
        <a class="news-card" href="/news/" aria-label="{{ n.title }}">
          <div class="news-img">
            {% if n.image %}
              <img src="{{ n.image.url }}" alt="{{ n.title }}">
            {% endif %}
          </div>
          <div class="news-body">
            <div class="news-title">{{ n.title }}</div>
            <div class="news-sub muted">{{ n.created_at|date:"d M Y" }}</div>
          </div>
        </a>
      {% empty %}
        <p class="muted">–ù–æ–≤–æ—Å—Ç–µ–π –ø–æ–∫–∞ –Ω–µ—Ç.</p>
      {% endfor %}
    </div>
  </article>
</section>

{% endblock %}
