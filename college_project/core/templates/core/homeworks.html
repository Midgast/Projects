{% extends "core/dashboard_base.html" %}

{% block title %}Домашние задания — College Core{% endblock %}

{% block topbar_left %}
  <div class="crumbs">Домашние задания</div>
{% endblock %}

{% block content %}
<section class="page">
  <div class="bento">

    <!-- Header card -->
    <article class="card bento-big tilt" data-tilt>
      <header class="card-h">
        <div>
          <div class="kicker">Цифровая система</div>
          <h2 class="h2">Домашние задания</h2>
        </div>
        <div class="pill">
          Выполнено: <strong style="margin-left:6px">{{ completed_count|default:0 }}</strong> /
          {{ total_count|default:0 }}
        </div>
      </header>

      <div class="card-b">
        <div class="split">
          <div class="block">
            <div class="label">Ближайший дедлайн</div>
            <div class="big">{{ nearest_deadline|default:"—" }}</div>
          </div>

          <div class="block">
            <div class="label">Режим</div>
            <div class="muted">Нажимай “Готово” — отметка сохранится без перезагрузки.</div>
          </div>
        </div>

        <div class="divider"></div>

        <form method="get" class="form">
          <select class="input" name="status">
            <option value="" {% if not status %}selected{% endif %}>Все</option>
            <option value="open" {% if status == "open" %}selected{% endif %}>Только невыполненные</option>
            <option value="done" {% if status == "done" %}selected{% endif %}>Только выполненные</option>
          </select>

          <select class="input" name="sort">
            <option value="deadline" {% if sort == "deadline" or not sort %}selected{% endif %}>Сортировать по дедлайну</option>
            <option value="-deadline" {% if sort == "-deadline" %}selected{% endif %}>Дедлайн (сначала поздние)</option>
            <option value="subject" {% if sort == "subject" %}selected{% endif %}>По предмету</option>
          </select>

          <button class="btn" type="submit">Применить</button>
        </form>
      </div>
    </article>

    <!-- List -->
    <article class="card bento-wide tilt" data-tilt>
      <header class="card-h">
        <div>
          <div class="kicker">Список</div>
          <h2 class="h2">Задачи</h2>
        </div>
        <div class="pill subtle">Клик = мгновенно</div>
      </header>

      <div class="card-b">
        {% if homeworks %}
          <div class="list">
            {% for hw in homeworks %}
              <div class="list-item {% if hw.completed %}is-done{% endif %}"
                   data-hw-row data-completed="{% if hw.completed %}1{% else %}0{% endif %}">
                <div class="check {% if hw.completed %}on{% endif %}">
                  {% if hw.completed %}✓{% else %}&nbsp;{% endif %}
                </div>

                <div class="list-main">
                  <div class="list-title">{{ hw.title|default:"Задание" }}</div>
                  <div class="list-sub">
                    {{ hw.subject.name|default:hw.subject|default:"—" }}
                    <span class="sep">·</span>
                    Дедлайн: <strong>{{ hw.deadline|date:"d.m.Y"|default:"—" }}</strong>
                  </div>
                </div>

                <div class="list-actions">
                  <button class="btn ghost" type="button" data-hw-toggle data-id="{{ hw.id }}">
                    {% if hw.completed %}Снять{% else %}Готово{% endif %}
                  </button>
                </div>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="empty">
            Домашек пока нет. Запусти <code>python manage.py seed</code> или добавь в админке.
          </div>
        {% endif %}
      </div>
    </article>

    <!-- Hint -->
    <article class="card bento-small tilt" data-tilt>
      <header class="card-h">
        <div>
          <div class="kicker">Подсказка</div>
          <h2 class="h2">Как добавить</h2>
        </div>
      </header>
      <div class="card-b">
        <ol class="steps">
          <li>Открой <span class="mono">/admin/</span></li>
          <li>Зайди в <span class="mono">Homeworks</span></li>
          <li>Создай задачу студенту и поставь дедлайн</li>
        </ol>
      </div>
    </article>

  </div>
</section>
{% endblock %}
